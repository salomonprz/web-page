<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Shopping Cart</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
    <!--Navbar information-->
    <nav id='menu'>
        <div class="header">KICKX</div> <!-- Header added here -->
        <input type='checkbox' id='responsive-menu' onclick='updatemenu()'><label></label>
        <ul>
            <li><a href='index.html'>HOME</a></li>
            <li><a class='dropdown-arrow' href='products.html'>PRODUCTS</a>
                <ul class='sub-menus'>
                    <li><a href='products.html'>Products 1</a></li>
                    <li><a href='products.html'>Products 2</a></li>
                    <li><a href='products.html'>Products 3</a></li>
                    <li><a href='products.html'>Products 4</a></li>
                </ul>
            </li>
            <li><a href='index.html'>ABOUT</a></li>
        </ul>
        <!-- Search bar added here -->
        <form class="example" action="index.html">
            <button type="submit"><i class="fa fa-search"></i></button>
        </form>
        <!-- User Icon added here -->
        <form class="example" action="index.html">
            <button type="submit"><i class="fa fa-user" style="font-size: 20px;"></i></button>
        </form>
        <!-- Cart icon added here -->
        <form class="example" action="cart.html">
            <button type="submit"><i class="fa fa-shopping-cart" style="font-size:20px"></i></button>
        </form>
    </nav>
    
    <h1>Your Cart</h1>
    <div id="cartContents"></div>
    <button onclick="checkoutCart()">Checkout</button>

    <script>
        function fetchCart() {
            fetch('/api/cart')
            .then(response => response.json())
            .then(cartItems => {
                const cartDiv = document.getElementById('cartContents');
                cartDiv.innerHTML = '';
                cartItems.forEach(item => {
                    cartDiv.innerHTML += `<div>Product ID: ${item.productId}, Quantity: ${item.quantity}
                                          <button onclick="removeFromCart('${item.productId}')">Remove</button></div>`;
                });
                if(cartItems.length === 0) {
                    cartDiv.innerHTML = '<p>Your cart is empty.</p>';
                }
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        }

        function removeFromCart(productId) {
            fetch(`/api/cart/${productId}`, { method: 'DELETE' })
            .then(response => response.text())
            .then(data => {
                alert('Item removed from cart');
                fetchCart(); // Refresh cart display
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        }

        function checkoutCart() {
            fetch('/api/cart/checkout', { method: 'POST' })
            .then(response => response.text())
            .then(data => {
                alert('Checkout successful, cart emptied');
                fetchCart(); // Refresh to show empty cart
            })
            .catch((error) => {
                console.error('Error:', error);
            });
        }

        fetchCart();
    </script>
</body>
</html>